<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quran Surah Translation Input</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
        }
        h1 {
            text-align: center;
        }
        #surah-select {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
        }
        .verse-container {
            margin-bottom: 20px;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 5px;
        }
        .verse-field {
            margin-bottom: 10px;
        }
        .verse-field label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .verse-text {
            font-size: 16px;
            direction: rtl;
        }
        textarea, input[type="text"], select {
            width: 100%;
            padding: 8px;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        textarea {
            height: 60px;
            resize: vertical;
        }
        #progress-bar {
            width: 100%;
            height: 20px;
            background-color: #f0f0f0;
            margin-top: 20px;
        }
        #progress-fill {
            height: 100%;
            background-color: #4CAF50;
            width: 0%;
            transition: width 0.3s;
        }
        #progress-text {
            text-align: center;
            margin-top: 10px;
        }
        button {
            padding: 10px 20px;
            background-color: #007BFF;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        #loading {
            text-align: center;
            display: none;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>Quran Surah Translation Input</h1>
    <select id="surah-select">
        <option value="">Select a Surah</option>
        <!-- Surah options will be populated dynamically -->
    </select>
    <div id="loading">Loading Arabic verses...</div>
    <div id="verses-container"></div>
    <div id="progress-bar">
        <div id="progress-fill"></div>
    </div>
    <div id="progress-text">Progress: 0%</div>
    <button onclick="saveProgress()">Save Progress</button>

    <script>
        const surahData = {
            "Al-Fatiha": { verseCount: 7, surahNumber: 1 },
            "Al-Baqarah": { verseCount: 286, surahNumber: 2 },
            "Al-Imran": { verseCount: 200, surahNumber: 3 },
            "An-Nisa": { verseCount: 176, surahNumber: 4 },
            "Al-Ma'idah": { verseCount: 120, surahNumber: 5 }
            // Add more Surahs as needed: "SurahName": { verseCount: X, surahNumber: Y }
        };

        const surahSelect = document.getElementById("surah-select");
        const versesContainer = document.getElementById("verses-container");
        const progressFill = document.getElementById("progress-fill");
        const progressText = document.getElementById("progress-text");
        const loadingDiv = document.getElementById("loading");

        // Populate Surah dropdown
        Object.keys(surahData).forEach(surah => {
            const option = document.createElement("option");
            option.value = surah;
            option.textContent = surah;
            surahSelect.appendChild(option);
        });

        // Load verses when a Surah is selected
        surahSelect.addEventListener("change", () => {
            const selectedSurah = surahSelect.value;
            if (selectedSurah) {
                loadVerses(selectedSurah);
                localStorage.setItem("lastSurah", selectedSurah);
            } else {
                versesContainer.innerHTML = "";
                updateProgress();
            }
        });

        async function loadVerses(surah) {
            versesContainer.innerHTML = "";
            loadingDiv.style.display = "block";
            const { verseCount, surahNumber } = surahData[surah];
            const savedData = JSON.parse(localStorage.getItem(`data_${surah}`)) || {};

            try {
                const response = await fetch(`https://api.alquran.cloud/v1/surah/${surahNumber}`);
                const data = await response.json();
                const arabicVerses = data.data.ayahs.map(ayah => ayah.text);

                for (let i = 1; i <= verseCount; i++) {
                    const verseData = savedData[i] || {
                        translation: "",
                        actionItems: "",
                        pictures: "",
                        completed: "No"
                    };
                    const arabicText = arabicVerses[i - 1] || "Arabic text not available";
                    const verseDiv = document.createElement("div");
                    verseDiv.className = "verse-container";
                    verseDiv.innerHTML = `
                        <div class="verse-field">
                            <label>Ayat Number:</label>
                            <div>${i}</div>
                        </div>
                        <div class="verse-field">
                            <label>Arabic Verse:</label>
                            <div class="verse-text">${arabicText}</div>
                        </div>
                        <div class="verse-field">
                            <label>Translation:</label>
                            <textarea placeholder="Enter translation for verse ${i}" data-verse="${i}" data-field="translation">${verseData.translation}</textarea>
                        </div>
                        <div class="verse-field">
                            <label>Action Items:</label>
                            <textarea placeholder="Enter action items for verse ${i}" data-verse="${i}" data-field="actionItems">${verseData.actionItems}</textarea>
                        </div>
                        <div class="verse-field">
                            <label>Pictures:</label>
                            <input type="text" placeholder="Enter picture name or URL for verse ${i}" data-verse="${i}" data-field="pictures" value="${verseData.pictures}">
                        </div>
                        <div class="verse-field">
                            <label>Completed (Y/N):</label>
                            <select data-verse="${i}" data-field="completed">
                                <option value="Yes" ${verseData.completed === "Yes" ? "selected" : ""}>Yes</option>
                                <option value="No" ${verseData.completed === "No" ? "selected" : ""}>No</option>
                            </select>
                        </div>
                    `;
                    versesContainer.appendChild(verseDiv);
                }

                // Add event listeners for real-time progress update
                document.querySelectorAll("textarea, input, select").forEach(element => {
                    element.addEventListener("input", updateProgress);
                });

                updateProgress();
            } catch (error) {
                console.error("Error fetching Arabic verses:", error);
                versesContainer.innerHTML = "<p>Error loading Arabic verses. Please try again later.</p>";
            } finally {
                loadingDiv.style.display = "none";
            }
        }

        function updateProgress() {
            const selectedSurah = surahSelect.value;
            if (!selectedSurah) {
                progressFill.style.width = "0%";
                progressText.textContent = "Progress: 0%";
                return;
            }

            const { verseCount } = surahData[selectedSurah];
            const selects = document.querySelectorAll("select[data-field='completed']");
            let completed = 0;

            selects.forEach(select => {
                if (select.value === "Yes") {
                    completed++;
                }
            });

            const percentage = (completed / verseCount) * 100;
            progressFill.style.width = `${percentage}%`;
            progressText.textContent = `Progress: ${percentage.toFixed(1)}%`;
        }

        function saveProgress() {
            const selectedSurah = surahSelect.value;
            if (!selectedSurah) return;

            const data = {};
            document.querySelectorAll(".verse-container").forEach(container => {
                const verse = container.querySelector("textarea[data-field='translation']").getAttribute("data-verse");
                data[verse] = {
                    translation: container.querySelector("textarea[data-field='translation']").value,
                    actionItems: container.querySelector("textarea[data-field='actionItems']").value,
                    pictures: container.querySelector("input[data-field='pictures']").value,
                    completed: container.querySelector("select[data-field='completed']").value
                };
            });

            localStorage.setItem(`data_${selectedSurah}`, JSON.stringify(data));
            alert("Progress saved!");
        }

        // Load saved Surah selection
        const lastSurah = localStorage.getItem("lastSurah");
        if (lastSurah && surahData[lastSurah]) {
            surahSelect.value = lastSurah;
            loadVerses(lastSurah);
        }
    </script>
</body>
</html>