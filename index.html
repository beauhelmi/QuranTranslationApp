<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quran TT Tracker</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
        }
        h1 {
            text-align: center;
        }
        #surah-select {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
        }
        .verse-container {
            margin-bottom: 20px;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 5px;
        }
        .verse-field {
            margin-bottom: 10px;
        }
        .verse-field label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .verse-text {
            font-size: 16px;
            direction: rtl;
        }
        textarea, input[type="text"], select {
            width: 100%;
            padding: 8px;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        textarea {
            height: 60px;
            resize: vertical;
        }
        #progress-bar {
            width: 100%;
            height: 20px;
            background-color: #f0f0f0;
            margin-top: 20px;
        }
        #progress-fill {
            height: 100%;
            background-color: #4CAF50;
            width: 0%;
            transition: width 0.3s;
        }
        #progress-text {
            text-align: center;
            margin-top: 10px;
        }
        button {
            padding: 10px 20px;
            background-color: #007BFF;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        #loading {
            text-align: center;
            display: none;
            margin: 20px 0;
        }
        #last-updated {
        text-align: center;
        margin: 10px 0;
        font-style: italic;
        }
        button {
            padding: 10px 20px;
            background-color: #007BFF;
            color: white;
            border: none;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        #dashboard, #surah-profile {
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 5px;
        }
        #dashboard h3, #surah-profile h3 {
            margin-top: 0;
        }
            #dashboard p, #surah-profile p {
                margin: 5px 0;
            }
            #dashboard span, #surah-profile span {
                font-weight: bold;
            }
            
    </style>
</head>
<body>
    <h1>Quran TT Tracker</h1>
    <select id="surah-select">
        <option value="">Select a Surah</option>
        <!-- Surah options will be populated dynamically -->
    </select>
    <div id="loading">Loading Arabic verses...</div>
    <div id="verses-container"></div>
    <div id="progress-bar">
        <div id="progress-fill"></div>
    </div>
    <div id="progress-text">Progress: 0%</div>
    <button onclick="saveProgress()">Save Progress</button>
    <div id="last-updated">Last updated: Not saved yet</div>
    <button onclick="exportData()">Export to Excel</button>
    <input type="file" id="import-file" accept=".json">
    <button onclick="importData()">Import Data</button>
    <button onclick="clearData()">Clear Data</button>
    <div id="dashboard" style="margin-top: 20px;">
        <h3>Dashboard</h3>
        <p id="total-surahs">Total Surahs: <span>0</span></p>
        <p id="completed-surahs">Completed Surahs: <span>0</span></p>
    </div>
    <div id="surah-profile" style="margin-top: 20px; display: none;">
        <h3>Surah Profile</h3>
        <p><strong>Name:</strong> <span id="profile-name"></span></p>
        <p><strong>Revelation Place:</strong> <span id="profile-place"></span></p>
        <p><strong>Theme:</strong> <span id="profile-theme"></span></p>
    </div>
    <script>
        const surahData = {
            "Al-Fatiha": { verseCount: 7, surahNumber: 1 , profile: { name: "Al-Fatiha", place: "Mecca", theme: "Prayer and Guidance" }},
            "Al-Baqarah": { verseCount: 286, surahNumber: 2, profile: { name: "Al-Baqarah", place: "Medina", theme: "Guidance for Mankind" }},
            "Al-Imran": { verseCount: 200, surahNumber: 3, profile: { name: "Al-Imran", place: "Medina", theme: "Family and Community" }},
            "An-Nisa": { verseCount: 176, surahNumber: 4, profile: { name: "An-Nisa", place: "Medina"}},
            "Al-Ma'idah": { verseCount: 120, surahNumber: 5, profile: { name: "Al-Ma'idah", place: "Medina", theme: "Law and Ethics" }},
            "Al-An'am": { verseCount: 165, surahNumber: 6, profile: { name: "Al-An'am", place: "Mecca", theme: "Faith and Worship" }},
            "Al-A'raf": { verseCount: 206, surahNumber: 7, profile: { name: "Al-A'raf", place: "Mecca", theme: "Prophets and Communities" }},
            "Al-Anfal": { verseCount: 75, surahNumber: 8, profile: { name: "Al-Anfal", place: "Medina", theme: "War and Peace" }},
            "At-Tawbah": { verseCount: 129, surahNumber: 9, profile: { name: "At-Tawbah", place: "Medina", theme: "Repentance and Forgiveness" }},                                                 
            // Add more Surahs as needed: "SurahName": { verseCount: X, surahNumber: Y }
        };

        const surahSelect = document.getElementById("surah-select");
        const versesContainer = document.getElementById("verses-container");
        const progressFill = document.getElementById("progress-fill");
        const progressText = document.getElementById("progress-text");
        const loadingDiv = document.getElementById("loading");

        // Populate Surah dropdown
        Object.keys(surahData).forEach(surah => {
            const option = document.createElement("option");
            option.value = surah;
            option.textContent = surah;
            surahSelect.appendChild(option);
        });

        // Load verses when a Surah is selected
      surahSelect.addEventListener("change", () => {
        const selectedSurah = surahSelect.value;
        if (selectedSurah) {
            loadVerses(selectedSurah);
            const profile = surahData[selectedSurah].profile;
            const profileDiv = document.getElementById("surah-profile");
            if (profile) {
                document.getElementById("profile-name").textContent = profile.name;
                document.getElementById("profile-place").textContent = profile.place;
                document.getElementById("profile-theme").textContent = profile.theme;
                profileDiv.style.display = "block";
            } else {
                profileDiv.style.display = "none";
            }
            localStorage.setItem("lastSurah", selectedSurah);
        } else {
            versesContainer.innerHTML = "";
            document.getElementById("surah-profile").style.display = "none";
            updateProgress();
        }
    });

        async function loadVerses(surah) {
            versesContainer.innerHTML = "";
            loadingDiv.style.display = "block";
            const { verseCount, surahNumber } = surahData[surah];
            const savedData = JSON.parse(localStorage.getItem(`data_${surah}`)) || {};

            try {
                const response = await fetch(`https://api.alquran.cloud/v1/surah/${surahNumber}`);
                const data = await response.json();
                const arabicVerses = data.data.ayahs.map(ayah => ayah.text);

                for (let i = 1; i <= verseCount; i++) {
                    const verseData = savedData[i] || {
                        translation: "",
                        actionItems: "",
                        pictures: "",
                        completed: "No"
                    };
                    const arabicText = arabicVerses[i - 1] || "Arabic text not available";
                    const verseDiv = document.createElement("div");
                    verseDiv.className = "verse-container";
                    verseDiv.innerHTML = `
                        <div class="verse-field">
                            <label>Ayat Number:</label>
                            <div>${i}</div>
                        </div>
                        <div class="verse-field">
                            <label>Arabic Verse:</label>
                            <div class="verse-text">${arabicText}</div>
                        </div>
                        <div class="verse-field">
                            <label>Translation:</label>
                            <textarea placeholder="Enter translation for verse ${i}" data-verse="${i}" data-field="translation">${verseData.translation}</textarea>
                        </div>
                        <div class="verse-field">
                            <label>Action Items:</label>
                            <textarea placeholder="Enter action items for verse ${i}" data-verse="${i}" data-field="actionItems">${verseData.actionItems}</textarea>
                        </div>
                        <div class="verse-field">
                            <label>Pictures:</label>
                            <input type="text" placeholder="Enter picture name or URL for verse ${i}" data-verse="${i}" data-field="pictures" value="${verseData.pictures}">
                        </div>
                        <div class="verse-field">
                            <label>Completed (Y/N):</label>
                            <select data-verse="${i}" data-field="completed">
                                <option value="Yes" ${verseData.completed === "Yes" ? "selected" : ""}>Yes</option>
                                <option value="No" ${verseData.completed === "No" ? "selected" : ""}>No</option>
                            </select>
                        </div>
                        <div class="verse-field">
                            <label>Nota Tambahan:</label>
                            <textarea placeholder="Enter additional notes for verse ${i}" data-verse="${i}" data-field="notes">${verseData.notes}</textarea>
                        </div>
                    `;
                    versesContainer.appendChild(verseDiv);
                }

                // Add event listeners for real-time progress update
                document.querySelectorAll("textarea, input, select").forEach(element => {
                    element.addEventListener("input", updateProgress);
                });

                updateProgress();
            } catch (error) {
                console.error("Error fetching Arabic verses:", error);
                versesContainer.innerHTML = "<p>Error loading Arabic verses. Please try again later.</p>";
            } finally {
                loadingDiv.style.display = "none";
            }
        }

        function updateProgress() {
            const selectedSurah = surahSelect.value;
            if (!selectedSurah) {
                progressFill.style.width = "0%";
                progressText.textContent = "Progress: 0%";
                return;
            }

            const { verseCount } = surahData[selectedSurah];
            const selects = document.querySelectorAll("select[data-field='completed']");
            let completed = 0;

            selects.forEach(select => {
                if (select.value === "Yes") {
                    completed++;
                }
            });

            const percentage = (completed / verseCount) * 100;
            progressFill.style.width = `${percentage}%`;
            progressText.textContent = `Progress: ${percentage.toFixed(1)}%`;
        }

        function saveProgress() {
            const selectedSurah = surahSelect.value;
            if (!selectedSurah) return;

            const data = {};
            document.querySelectorAll(".verse-container").forEach(container => {
                const verse = container.querySelector("textarea[data-field='translation']").getAttribute("data-verse");
                data[verse] = {
                    translation: container.querySelector("textarea[data-field='translation']").value,
                    actionItems: container.querySelector("textarea[data-field='actionItems']").value,
                    pictures: container.querySelector("input[data-field='pictures']").value,
                    completed: container.querySelector("select[data-field='completed']").value
                };
            });
            
            const timestamp = new Date().toLocaleString();
        localStorage.setItem(`data_${selectedSurah}`, JSON.stringify({ verses: data, lastUpdated: timestamp }));
        document.getElementById("last-updated").textContent = `Last updated: ${timestamp}`;            
        alert("Progress saved!");
        }

        function exportData() {
            const selectedSurah = surahSelect.value;
            if (!selectedSurah) {
                alert("Please select a Surah to export.");
                return;
            }
            const data = JSON.parse(localStorage.getItem(`data_${selectedSurah}`)) || {};
            if (!data.verses) {
                alert("No data to export for this Surah.");
                return;
            }
            let csv = "Ayat Number,Arabic Verse,Translation,Action Items,Pictures,Completed,Nota Tambahan\n";
            const { verseCount, surahNumber } = surahData[selectedSurah];
            for (let i = 1; i <= verseCount; i++) {
                const verseData = data.verses[i] || {};
                csv += `${i},${verseData.arabic || ""},"${verseData.translation || ""}","${verseData.actionItems || ""}","${verseData.pictures || ""}",${verseData.completed || "No"},"${verseData.notes || ""}"\n`;
            }
            const blob = new Blob([csv], { type: "text/csv" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = `${selectedSurah}_data.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importData() {
            const selectedSurah = surahSelect.value;
            if (!selectedSurah) {
                alert("Please select a Surah first.");
                return;
            }
            const fileInput = document.getElementById("import-file");
            const file = fileInput.files[0];
            if (!file) {
                alert("Please select a file to import.");
                return;
            }
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    localStorage.setItem(`data_${selectedSurah}`, JSON.stringify(data));
                    loadVerses(selectedSurah);
                    alert("Data imported successfully!");
                } catch (error) {
                    alert("Error importing data. Please ensure it’s a valid JSON file.");
                }
            };
            reader.readAsText(file);
        }

        function clearData() {
            const selectedSurah = surahSelect.value;
            if (!selectedSurah) {
                alert("Please select a Surah to clear.");
                return;
            }
            if (confirm(`Are you sure you want to clear all data for ${selectedSurah}?`)) {
                localStorage.removeItem(`data_${selectedSurah}`);
                loadVerses(selectedSurah);
                alert("Data cleared!");
            }
        }

        function updateDashboard() {
            const totalSurahs = Object.keys(surahData).length;
            let completedSurahs = 0;
            Object.keys(surahData).forEach(surah => {
                const data = JSON.parse(localStorage.getItem(`data_${surah}`)) || {};
                const verses = data.verses || {};
                const verseCount = surahData[surah].verseCount;
                const completed = Object.values(verses).filter(v => v.completed === "Yes").length;
                if (completed === verseCount) completedSurahs++;
            });
            document.getElementById("total-surahs").querySelector("span").textContent = totalSurahs;
            document.getElementById("completed-surahs").querySelector("span").textContent = completedSurahs;
        }

        // Load saved Surah selection
        const lastSurah = localStorage.getItem("lastSurah");
        if (lastSurah && surahData[lastSurah]) {
            surahSelect.value = lastSurah;
            loadVerses(lastSurah);
        }
    </script>
</body>
</html>